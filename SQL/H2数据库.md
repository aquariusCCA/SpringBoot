---
up:
  - "[[SpringBoot 課程描述]]"
---
截止到目前，springboot给开发者提供了内置的数据源解决方案和持久化解决方案，在数据层解决方案三件套中还剩下一个数据库，莫非springboot也提供有内置的解决方案？还真有，还不是一个，三个，这一节就来说说内置的数据库解决方案。

​springboot提供了3款内置的数据库，分别是

- H2
- HSQL
- Derby

​以上三款数据库除了可以独立安装之外，还可以像是tomcat服务器一样，采用内嵌的形式运行在spirngboot容器中。内嵌在容器中运行，那必须是java对象啊，对，这三款数据库底层都是使用java语言开发的。

​我们一直使用MySQL数据库就挺好的，为什么有需求用这个呢？原因就在于这三个数据库都可以采用内嵌容器的形式运行，在应用程序运行后，如果我们进行测试工作，此时测试的数据无需存储在磁盘上，但是又要测试使用，内嵌数据库就方便了，运行在内存中，该测试测试，该运行运行，等服务器关闭后，一切烟消云散，多好，省得你维护外部数据库了。这也是内嵌数据库的最大优点，方便进行功能测试。

​下面以H2数据库为例讲解如何使用这些内嵌数据库，操作步骤也非常简单，简单才好用嘛

**步骤 1**：导入H2数据库对应的坐标，一共2个

```xml
<dependency>
    <groupId>com.h2database</groupId>
    <artifactId>h2</artifactId>
</dependency>
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-data-jpa</artifactId>
</dependency>
```

**步骤 2**：将工程设置为web工程，启动工程时启动H2数据库

```xml
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-web</artifactId>
</dependency>
```

**步骤 3**：通过配置开启H2数据库控制台访问程序，也可以使用其他的数据库连接软件操作

```yaml
server:
  port: 80
  
spring:
  # 配置数据库和连接池
  datasource:
    url: jdbc:h2:~/test
    hikari:
      driver-class-name: org.h2.Driver
      username: sa
      password: 123456

  # 启用H2的控制台
  h2:
    console:
      enabled: true
      path: /h2
```

在浏览器中输入访问`H2`控制台地址

![[image-20220124170318554.png]]

​web端访问路径 /h2，输入默认密码：`123456`，然后点连接，会跳转到控制台主页

![[image-20220124170509519.png]]

**步骤 4**：可以写`sql`语句建表，并插入几条数据

```sql
create table tbl_book(
   id int,
   type varchar,
   name varchar,
   description varchar
);

insert into tbl_book values(1, 'springboot1', 'springboot2', 'springboot3');
insert into tbl_book values(2, 'springboot4', 'springboot5', 'springboot6');
insert into tbl_book values(3, 'springboot7', 'springboot8', 'springboot9');
insert into tbl_book values(4, 'springboot10', 'springboot11', 'springboot12');
```

​![[image-20220124170949962.png]]

![[image-20220124171610075.png]]

查询`tbl_book`表中的数据

```sql
select * from tbl_book;
```

![[image-20220124171707774.png]]

**步骤 5** ：写代码连接`H2`数据库

需要注意启动测试类连接H2数据库的时候需要将之前的H2控制台的`springboot`程序先停止，否则会造成端口占用，测试类报错。

测试类：

```java
@SpringBootTest
class H2ApplicationTests {
    @Autowired
    private JdbcTemplate jdbcTemplate;

    @Test
    public void testH2Select() {
        String sql = "select * from tbl_book";

        RowMapper<Book> rm = new RowMapper<Book>() {
            @Override
            public Book mapRow(ResultSet rs, int rowNum) throws SQLException {
                Book book = new Book();
                book.setId(rs.getInt("id"));
                book.setName(rs.getString("name"));
                book.setType(rs.getString("type"));
                book.setDescription(rs.getString("description"));
                return book;
            }
        };
        List<Book> bookList = jdbcTemplate.query(sql, rm);
        bookList.forEach(System.out::println);
    }

    @Test
    public void testH2Save() {
        String sql = "insert into tbl_book values(?, ? ,? ,?)";
        jdbcTemplate.update(sql, 5, "啊哈算法", "计算机", "数据结构和算法");
    }
}
```

**步骤 6** ：`H2`数据库线上运行时请务必关闭。

其实我们只是换了一个数据库而已，其他的东西都不受影响。一个重要提醒，别忘了，上线时，把内存级数据库关闭，采用MySQL数据库作为数据持久化方案，关闭方式就是设置 enabled 属性为false即可。

> [!NOTE] **总结**
> 
> - H2内嵌式数据库启动方式，添加坐标，添加配置
> - H2数据库线上运行时请务必关闭

到这里SQL相关的数据层解决方案就讲完了，现在的可选技术就丰富的多了。

- 数据源技术：Druid、Hikari、tomcat DataSource、DBCP
- 持久化技术：MyBatisPlus、MyBatis、JdbcTemplate
- 数据库技术：MySQL、H2、HSQL、Derby

​现在开发程序时就可以在以上技术中任选一种组织成一套数据库解决方案了。
---
up:
  - "[[SpringBoot 課程描述]]"
  - "[[监控]]"
---
springboot抽取了大部分监控系统的常用指标，提出了监控的总思想。然后就有好心的同志根据监控的总思想，制作了一个通用性很强的监控系统，因为是基于springboot监控的核心思想制作的，所以这个程序被命名为**Spring Boot Admin**。

​Spring Boot Admin，这是一个开源社区项目，用于管理和监控SpringBoot应用程序。这个项目中包含有客户端和服务端两部分，而监控平台指的就是服务端。我们做的程序如果需要被监控，将我们做的程序制作成客户端，然后配置服务端地址后，服务端就可以通过HTTP请求的方式从客户端获取对应的信息，并通过UI界面展示对应信息。

​下面就来开发这套监控程序，先制作服务端，其实服务端可以理解为是一个web程序，收到一些信息后展示这些信息。

---

# **服务端开发**

**步骤①**：导入springboot admin对应的starter，版本与当前使用的springboot版本保持一致，并将其配置成web工程

```xml
<dependency>
	<groupId>de.codecentric</groupId>
	<artifactId>spring-boot-admin-starter-server</artifactId>
</dependency>
<dependency>
	<groupId>org.springframework.boot</groupId>
	<artifactId>spring-boot-starter-web</artifactId>
</dependency>
```

​上述过程可以通过创建项目时使用勾选的形式完成。

![[监控/附件/image-20220301102432817.png]]

**步骤②**：在引导类上添加注解 @EnableAdminServer，声明当前应用启动后作为SpringBootAdmin的服务器使用

```java
@SpringBootApplication
@EnableAdminServer
public class Springboot25AdminServerApplication {
    public static void main(String[] args) {
        SpringApplication.run(Springboot25AdminServerApplication.class, args);
    }
}
```

​做到这里，这个服务器就开发好了，启动后就可以访问当前程序了，界面如下。

![[监控/附件/image-20220301103028468.png]]

由于目前没有启动任何被监控的程序，所以里面什么信息都没有。下面制作一个被监控的客户端程序。

---

# **客户端开发**

​客户端程序开发其实和服务端开发思路基本相似，多了一些配置而已。

**步骤①**：导入springboot admin对应的starter，版本与当前使用的springboot版本保持一致，并将其配置成web工程

```xml
<dependency>
	<groupId>org.springframework.boot</groupId>
	<artifactId>spring-boot-starter-web</artifactId>
</dependency>
<dependency>
	<groupId>de.codecentric</groupId>
	<artifactId>spring-boot-admin-starter-client</artifactId>
</dependency>
```

​上述过程也可以通过创建项目时使用勾选的形式完成，不过一定要小心，端口配置成不一样的，否则会冲突。

**步骤②**：设置当前客户端将信息上传到哪个服务器上，通过yml文件配置

```yaml
spring:
  boot:
    admin:
      client:
        url: http://localhost:8080
```

​做到这里，这个客户端就可以启动了。启动后再次访问服务端程序，界面如下。

![[监控/附件/image-20220301103838079.png]]

​可以看到，当前监控了1个程序，点击进去查看详细信息。

![[监控/附件/image-20220301103936386.png]]

​由于当前没有设置开放哪些信息给监控服务器，所以目前看不到什么有效的信息。下面需要做两组配置就可以看到信息了。

1. 开放指定信息给服务器看

2. 允许服务器以HTTP请求的方式获取对应的信息

   配置如下：

```yaml
server:
  port: 80
spring:
  boot:
    admin:
      client:
        url: http://localhost:8080
management:
  endpoint:
    health:
      show-details: always
  endpoints:
    web:
      exposure:
        include: "*"
```

​上述配置对于初学者来说比较容易混淆。简单解释一下，到下一节再做具体的讲解。

springbootadmin的客户端默认开放了13组信息给服务器，但是这些信息除了一个之外，其他的信息都不让通过HTTP请求查看。所以你看到的信息基本上就没什么内容了，只能看到一个内容，就是下面的健康信息。

![[监控/附件/image-20220301104742563.png]]

​但是即便如此我们看到健康信息中也没什么内容，原因在于健康信息中有一些信息描述了你当前应用使用了什么技术等信息，如果无脑的对外暴露功能会有安全隐患。通过配置就可以开放所有的健康信息明细查看了。

```yaml
management:
  endpoint:
    health:
      show-details: always
```

​健康明细信息如下：

![[监控/附件/image-20220301105116554.png]]

​目前除了健康信息，其他信息都查阅不了。原因在于其他12种信息是默认不提供给服务器通过HTTP请求查阅的，所以需要开启查阅的内容项，使用 *表示查阅全部。记得带引号*。

```yaml
endpoints:
  web:
    exposure:
      include: "*"
```

​配置后再刷新服务器页面，就可以看到所有的信息了。

![[监控/附件/image-20220301105554494.png]]

​以上界面中展示的信息量就非常大了，包含了13组信息，有性能指标监控，加载的bean列表，加载的系统属性，日志的显示控制等等。

---

# **配置多个客户端**

​可以通过配置客户端的方式在其他的springboot程序中添加客户端坐标，这样当前服务器就可以监控多个客户端程序了。每个客户端展示不同的监控信息。

![[监控/附件/image-20220301110352170.png]]

​进入监控面板，如果你加载的应用具有功能，在监控面板中可以看到3组信息展示的与之前加载的空工程不一样。

### 类加载面板中可以查阅到开发者自定义的类，如左图

![[监控/附件/image-20220301161246835.png]]
![[监控/附件/image-20220301161949431.png]]

### 映射中可以查阅到当前应用配置的所有请求

![[监控/附件/image-20220301161418791.png]]
![[监控/附件/image-20220301162008737.png]]

### 性能指标中可以查阅当前应用独有的请求路径统计数据

![[监控/附件/image-20220301161906949.png]]
![[监控/附件/image-20220301162040670.png]]

---

> [!NOTE] **总结**
> 
> - 开发监控服务端需要导入坐标，然后在引导类上添加注解@EnableAdminServer，并将其配置成web程序即可
> - 开发被监控的客户端需要导入坐标，然后配置服务端服务器地址，并做开放指标的设定即可
> - 在监控平台中可以查阅到各种各样被监控的指标，前提是客户端开放了被监控的指标

> [!NOTE] **思考**
> 
> 之前说过，服务端要想监控客户端，需要主动的获取到对应信息并展示出来。但是目前我们并没有在客户端开发任何新的功能，但是服务端确可以获取监控信息，谁帮我们做的这些功能呢？咱们下一节再讲。

​		
---
up:
  - "[[SpringBoot 課程描述]]"
---
# 购物订单发送手机短信案例

> 为了便于下面演示各种各样的消息中间件技术，我们创建一个购物过程生成订单时为用户发送短信的案例环境，模拟使用消息中间件实现发送手机短信的过程。

​手机验证码案例需求如下：

- 执行下单业务时（模拟此过程），调用消息服务，将要发送短信的订单 id 传递给消息中间件

- 消息处理服务接收到要发送的订单 id 后输出订单 id（模拟发短信）

由于不涉及数据读写，仅开发业务层与表现层，其中短信处理的业务代码独立开发，代码如下：

## **订单业务**

​**业务层接口**

```JAVA
public interface OrderService {
    void order(String id);
}
```

​模拟传入订单id，执行下订单业务，参数为虚拟设定，实际应为订单对应的实体类

​**业务层实现**

```JAVA
@Service
public class OrderServiceImpl implements OrderService {
    @Autowired
    private MessageService messageService;
    
    @Override
    public void order(String id) {
        //一系列操作，包含各种服务调用，处理各种业务
        System.out.println("订单处理开始");
        //短信消息处理
        messageService.sendMessage(id);
        System.out.println("订单处理结束");
        System.out.println();
    }
}
```

​业务层转调短信处理的服务 MessageService

​**表现层服务**

```JAVA
@RestController
@RequestMapping("/orders")
public class OrderController {

    @Autowired
    private OrderService orderService;

    @PostMapping("{id}")
    public void order(@PathVariable String id){
        orderService.order(id);
    }
}
```

​表现层对外开发接口，传入订单 id 即可（模拟）

## **短信处理业务**

​**业务层接口**

```JAVA
public interface MessageService {
    void sendMessage(String id);
    String doMessage();
}
```

​短信处理业务层接口提供两个操作，发送要处理的订单 id 到消息中间件，另一个操作目前暂且设计成处理消息，实际消息的处理过程不应该是手动执行，应该是自动执行，到具体实现时再进行设计

​**业务层实现**

```JAVA
@Service
public class MessageServiceImpl implements MessageService {
    private ArrayList<String> msgList = new ArrayList<String>();

    @Override
    public void sendMessage(String id) {
        System.out.println("待发送短信的订单已纳入处理队列，id："+id);
        msgList.add(id);
    }

    @Override
    public String doMessage() {
        String id = msgList.remove(0);
        System.out.println("已完成短信发送业务，id："+id);
        return id;
    }
}
```

​短信处理业务层实现中使用集合先模拟消息队列，观察效果

​**表现层服务**

```JAVA
@RestController
@RequestMapping("/msgs")
public class MessageController {

    @Autowired
    private MessageService messageService;

    @GetMapping
    public String doMessage(){
        String id = messageService.doMessage();
        return id;
    }
}
```

​短信处理表现层接口暂且开发出一个处理消息的入口，但是此业务是对应业务层中设计的模拟接口，实际业务不需要设计此接口。
---
up:
  - "[[SpringBoot 課程描述]]"
---
# 根据任意条件确认是否加载 bean

```java
@Import(MyImportSelector.class)
public class SpringConfig {  }
```

```java
@Component("tom")  
public class Cat {  }
```

```java
@Component("jerry")
public class Mouse { }
```

```java
public class MyImportSelector implements ImportSelector {
    @Override
    public String[] selectImports(AnnotationMetadata importingClassMetadata) {
        try {
//            Class<?> clazz = Class.forName("com.test.pojo.eMouse");
            Class<?> clazz = Class.forName("com.test.pojo.Mouse");
            if(clazz != null) {
                return new String[]{"com.test.pojo.Cat"};
            }
        } catch (ClassNotFoundException e) {
            return new String[0];
        }
        return null;
    }
}
```

```java
@SpringBootApplication
public class TestSpringBootApplication {
    public static void main(String[] args) {
        ApplicationContext ctx = new AnnotationConfigApplicationContext(SpringConfig.class);
        String[] beans = ctx.getBeanDefinitionNames();
        for (String bean : beans) {
            System.out.println(bean);
        }
    }
}
```

---

# 使用@Conditional注解的派生注解设置各种组合条件控制bean的加载

### 匹配指定类

```java
public class SpringConfig {
	@Bean
	@ConditionalOnClass(Mouse.class)
	public Cat tom(){
		return new Cat();
	}
}
```

### 未匹配指定类

```java
public class SpringConfig {
	@Bean
	@ConditionalOnClass(Mouse.class)
	@ConditionalOnMissingClass("com.itheima.bean.Wolf")
	public Cat tom(){
		return new Cat();
	}
}
```

> 多個 `@Conditional…` 是AND 關係：全都為真才會註冊 

### 匹配指定类型的bean

```java
@Import(Mouse.class)
public class SpringConfig {
	@Bean
	@ConditionalOnBean(Mouse.class)
	public Cat tom(){
		return new Cat();
	}
}
```

### 匹配指定名称的bean

```java
@Import(Mouse.class)
public class SpringConfig {
    @Bean
    @ConditionalOnBean(name="com.test.pojo.Mouse")
    public Cat tom(){
        return new Cat();
    }
}
```

### 匹配指定名称的bean

```java
@Import(Mouse.class)
public class SpringConfig {
	@Bean
	@ConditionalOnBean(name="com.itheima.bean.Mouse")
	public Cat tom(){
		return new Cat();
	}
}
```

### 匹配指定环境

```java
@Import(Mouse.class)
public class SpringConfig {
	@Bean
	@ConditionalOnBean(name=
	"jerry")
	public Cat tom(){
		return new Cat();
	}
}
```

### 匹配指定环境

```java
@Configuration
@Import(Mouse.class)
public class MyConfig {
	@Bean
	@ConditionalOnClass(Mouse.class)
	@ConditionalOnMissingClass("com.itheima.bean.Dog")
	@ConditionalOnNotWebApplication
	public Cat tom(){
		return new Cat();
	}
}
```

> 多個 `@Conditional…` 是AND 關係：全都為真才會註冊 